<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SubExplore.Views.Spots.SpotDetailsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
    xmlns:viewmodels="clr-namespace:SubExplore.ViewModels.Spots"
    xmlns:common="clr-namespace:SubExplore.Views.Common"
    xmlns:domain="clr-namespace:SubExplore.Models.Domain"
    x:DataType="viewmodels:SpotDetailsViewModel"
    Title="{Binding Title}"
    BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Page Header with Menu -->
        <common:PageHeaderView x:Name="PageHeader" 
                               Grid.Row="0"
                               Title="{Binding Title}"
                               ShowBackButton="True"
                               BackCommand="{Binding BackCommand}" />
        
        <!-- Main content with loading overlay -->
        <Grid Grid.Row="1">
            <ScrollView IsVisible="{Binding IsLoading, Converter={StaticResource InvertBoolConverter}}">
            <VerticalStackLayout Padding="15" Spacing="15">

                <!--  Carousel de photos  -->
                <Frame
                    Padding="0"
                    CornerRadius="10"
                    HeightRequest="250"
                    IsClippedToBounds="True"
                    AutomationId="PhotoCarouselFrame">
                    <Grid>
                        <CarouselView
                            HeightRequest="250"
                            IndicatorView="indicatorView"
                            ItemsSource="{Binding SpotMedias}"
                            IsVisible="{Binding HasPhotos}"
                            AutomationId="SpotPhotoCarousel"
                            SemanticProperties.Description="Galerie de photos du spot">
                            <CarouselView.ItemTemplate>
                                <DataTemplate x:DataType="domain:SpotMedia">
                                    <Grid>
                                        <Image Aspect="AspectFill" 
                                               Source="{Binding MediaUrl}"
                                               AutomationId="SpotPhotoImage"
                                               SemanticProperties.Description="Photo du spot de plongÃ©e" />
                                        <!-- Image loading error indicator -->
                                        <Grid BackgroundColor="#F0F0F0"
                                              IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.HasImageLoadError}">
                                            <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                                                <Label Text=""
                                                       FontSize="32"
                                                       HorizontalOptions="Center" />
                                                <Label Text="Image non disponible"
                                                       FontSize="14"
                                                       TextColor="{StaticResource TextSecondary}"
                                                       HorizontalOptions="Center" />
                                            </StackLayout>
                                        </Grid>
                                    </Grid>
                                </DataTemplate>
                            </CarouselView.ItemTemplate>
                        </CarouselView>
                        
                                <!-- Media loading indicator -->
                        <StackLayout VerticalOptions="End" 
                                    HorizontalOptions="End"
                                    BackgroundColor="#80000000"
                                    Padding="10,5"
                                    IsVisible="{Binding IsLoadingMedia}"
                                    AutomationId="MediaLoadingIndicator">
                            <StackLayout Orientation="Horizontal" Spacing="5">
                                <ActivityIndicator IsRunning="{Binding IsLoadingMedia}"
                                                   Color="White"
                                                   HeightRequest="20"
                                                   WidthRequest="20" />
                                <Label Text="Chargement photos..."
                                       TextColor="White"
                                       FontSize="12" />
                            </StackLayout>
                        </StackLayout>
                        
                        <!-- Media count indicator -->
                        <StackLayout VerticalOptions="End" 
                                    HorizontalOptions="Start"
                                    BackgroundColor="#80000000"
                                    Padding="8,4"
                                    IsVisible="{Binding HasPhotos}"
                                    AutomationId="MediaCountIndicator">
                            <Label TextColor="White"
                                   FontSize="12"
                                   SemanticProperties.Description="Nombre de photos chargÃ©es">
                                <Label.Text>
                                    <MultiBinding StringFormat="{}{0}/{1} photos">
                                        <Binding Path="LoadedMediaCount" />
                                        <Binding Path="TotalMediaCount" />
                                    </MultiBinding>
                                </Label.Text>
                            </Label>
                        </StackLayout>
                        
                        <!-- No photos placeholder -->
                        <StackLayout VerticalOptions="Center" 
                                    HorizontalOptions="Center"
                                    IsVisible="{Binding HasPhotos, Converter={StaticResource InvertBoolConverter}}"
                                    AutomationId="NoPhotosPlaceholder">
                            <Label Text="No Photos"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextSecondary}"
                                   HorizontalOptions="Center"
                                   SemanticProperties.Description="Aucune photo disponible" />
                            <Label Text="Aucune photo disponible"
                                   FontSize="16"
                                   TextColor="{StaticResource TextSecondary}"
                                   HorizontalOptions="Center"
                                   Margin="0,10,0,0"
                                   SemanticProperties.Description="Aucune photo n'est disponible pour ce spot" />
                        </StackLayout>
                    </Grid>
                </Frame>

                <IndicatorView
                    x:Name="indicatorView"
                    HorizontalOptions="Center"
                    IndicatorColor="{StaticResource Gray400}"
                    SelectedIndicatorColor="{StaticResource Primary}" />

                <!--  En-tÃªte avec infos principales  -->
                <Frame BorderColor="{StaticResource Secondary}">
                    <Frame.Padding>
                        <OnIdiom x:TypeArguments="Thickness" Phone="15" Tablet="25" Desktop="30" />
                    </Frame.Padding>
                    <Frame.MinimumHeightRequest>
                        <OnIdiom x:TypeArguments="x:Double" Phone="160" Tablet="200" Desktop="220" />
                    </Frame.MinimumHeightRequest>
                    <Grid RowDefinitions="Auto,*" RowSpacing="15">
                        <!-- PremiÃ¨re ligne: Titre et bouton favori -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="{Binding Spot.Name}"
                                TextColor="{StaticResource Primary}"
                                VerticalOptions="Center"
                                LineBreakMode="WordWrap"
                                MaxLines="2">
                                <Label.FontSize>
                                    <OnIdiom x:TypeArguments="x:Double" Phone="22" Tablet="26" Desktop="28" />
                                </Label.FontSize>  
                            </Label>

                            <!-- Favorite button with count -->
                            <StackLayout Grid.Column="1" 
                                       Orientation="Horizontal" 
                                       VerticalOptions="Start"
                                       Spacing="8"
                                       Margin="10,0,0,0">
                                <StackLayout Orientation="Vertical" 
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             Spacing="2">
                                    
                                    <Grid WidthRequest="44" HeightRequest="44"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center">
                                        
                                        <!-- Subtle background circle -->
                                        <Ellipse Fill="#20FFFFFF"
                                                 Stroke="#40FFFFFF"
                                                 StrokeThickness="1"
                                                 WidthRequest="44"
                                                 HeightRequest="44"
                                                 HorizontalOptions="Center"
                                                 VerticalOptions="Center" />
                                        
                                        <!-- Loading indicator -->
                                        <ActivityIndicator IsRunning="{Binding IsLoadingFavorite}"
                                                           IsVisible="{Binding IsLoadingFavorite}"
                                                           Color="{StaticResource Primary}"
                                                           WidthRequest="22"
                                                           HeightRequest="22"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center" />
                                        
                                        <!-- Favorite button -->
                                        <Button Command="{Binding ToggleFavoriteCommand}"
                                                BackgroundColor="Transparent"
                                                BorderWidth="0"
                                                Padding="0"
                                                Margin="0"
                                                WidthRequest="44"
                                                HeightRequest="44"
                                                HorizontalOptions="Center"
                                                VerticalOptions="Center"
                                                IsEnabled="{Binding IsLoadingFavorite, Converter={StaticResource InvertBoolConverter}}"
                                                IsVisible="{Binding IsLoadingFavorite, Converter={StaticResource InvertBoolConverter}}"
                                                AutomationId="FavoriteToggleButton"
                                                SemanticProperties.Description="Ajouter ou retirer ce spot des favoris"
                                                SemanticProperties.Hint="Appuyez pour basculer l'Ã©tat favori" />
                                        
                                        <!-- Heart icon overlay -->
                                        <Label Text="{Binding IsFavorite, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='Favori|Ajouter aux favoris'}"
                                               FontSize="26"
                                               TextColor="{Binding IsFavorite, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='#E91E63|{StaticResource TextSecondary}'}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               InputTransparent="True"
                                               IsVisible="{Binding IsLoadingFavorite, Converter={StaticResource InvertBoolConverter}}" />
                                        
                                    </Grid>
                                
                                    <Label Text="{Binding FavoritesCount}"
                                           FontSize="11"
                                           TextColor="{StaticResource TextSecondary}"
                                           HorizontalOptions="Center"
                                           IsVisible="{Binding FavoritesCount, Converter={StaticResource IntGreaterThanOrEqualConverter}, ConverterParameter='1'}" />
                                </StackLayout>
                            </StackLayout>
                        </Grid>

                        <!-- DeuxiÃ¨me ligne: Informations dÃ©taillÃ©es sur deux colonnes pour tablette/desktop -->
                        <Grid Grid.Row="1" VerticalOptions="FillAndExpand">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Type de spot -->
                            <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="0,5">
                                <Label Text="" FontSize="16" VerticalOptions="Center" />
                                <Label FontAttributes="Bold"
                                       Text="{Binding Spot.Type.Name}"
                                       TextColor="{StaticResource Secondary}"
                                       FontSize="16"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start" />
                            </StackLayout>

                            <!-- DifficultÃ© -->
                            <StackLayout Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,5">
                                <Label Text="âš¡" FontSize="16" VerticalOptions="Center" />
                                <Label TextColor="{StaticResource TextSecondary}"
                                       FontSize="16"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start">
                                    <Label.Text>
                                        <MultiBinding StringFormat="DifficultÃ©: {0}">
                                            <Binding Path="Spot.DifficultyLevel" Converter="{StaticResource DifficultyLevelToFrenchConverter}" />
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>
                            </StackLayout>

                            <!-- Profondeur -->
                            <StackLayout Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="0,5">
                                <Label Text="" FontSize="16" VerticalOptions="Center" />
                                <Label Text="{Binding Spot.MaxDepth, StringFormat='Profondeur: {0}m'}"
                                       FontSize="16"
                                       TextColor="{StaticResource TextPrimary}"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start" />
                            </StackLayout>

                            <!-- Courant -->
                            <StackLayout Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,5">
                                <Label Text="ðŸ’¨" FontSize="16" VerticalOptions="Center" />
                                <Label FontSize="16"
                                       TextColor="{StaticResource TextPrimary}"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Start">
                                    <Label.Text>
                                        <MultiBinding StringFormat="Courant: {0}">
                                            <Binding Path="Spot.CurrentStrength" Converter="{StaticResource CurrentStrengthToFrenchConverter}" />
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>
                            </StackLayout>
                        </Grid>
                    </Grid>
                </Frame>

                <!--  Carte de localisation  -->
                <Frame
                    Padding="0"
                    CornerRadius="10"
                    IsClippedToBounds="True">
                    <Frame.HeightRequest>
                        <OnIdiom x:TypeArguments="x:Double" Phone="220" Tablet="300" Desktop="350" />
                    </Frame.HeightRequest>
                    <maps:Map
                        x:Name="spotMap"
                        IsScrollEnabled="True"
                        IsZoomEnabled="True"
                        IsShowingUser="False"
                        MapType="Street"
                        AutomationId="SpotLocationMap"
                        SemanticProperties.Description="Carte montrant la localisation du spot de plongÃ©e" />
                </Frame>

                <!--  Description et notes de sÃ©curitÃ©  -->
                <Frame Padding="15" BorderColor="{StaticResource Secondary}">
                    <VerticalStackLayout Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            Text="Description"
                            TextColor="{StaticResource Primary}" />

                        <Label Text="{Binding Spot.Description}" />
                    </VerticalStackLayout>
                </Frame>

                <!--  Notes de sÃ©curitÃ©  -->
                <Frame
                    Padding="15"
                    BackgroundColor="#FFF3E0"
                    BorderColor="{StaticResource Warning}">
                    <VerticalStackLayout Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            Text="Notes de sÃ©curitÃ©"
                            TextColor="{StaticResource Primary}" />

                        <Label Text="{Binding Spot.SafetyNotes}" />
                    </VerticalStackLayout>
                </Frame>

                <!--  Conditions mÃ©tÃ©o  -->
                <Frame Padding="15" BorderColor="{StaticResource Secondary}"
                       IsVisible="{Binding HasWeatherData}">
                    <VerticalStackLayout Spacing="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="Conditions mÃ©tÃ©o"
                                TextColor="{StaticResource Primary}"
                                VerticalOptions="Center" />

                            <!-- Refresh button -->
                            <Button Grid.Column="1"
                                    Text="Actualiser"
                                    FontSize="16"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    BackgroundColor="Transparent"
                                    TextColor="{StaticResource Primary}"
                                    Command="{Binding RefreshWeatherCommand}"
                                    IsEnabled="{Binding IsLoadingWeather, Converter={StaticResource InvertBoolConverter}}"
                                    Margin="5,0"
                                    AutomationId="RefreshWeatherButton"
                                    SemanticProperties.Description="Actualiser les donnÃ©es mÃ©tÃ©o"
                                    SemanticProperties.Hint="Appuyez pour actualiser la mÃ©tÃ©o" />

                            <!-- Details button -->
                            <Button Grid.Column="2"
                                    Text="Partager"
                                    FontSize="16"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    BackgroundColor="Transparent"
                                    TextColor="{StaticResource Primary}"
                                    Command="{Binding ShowWeatherDetailsCommand}"
                                    IsEnabled="{Binding HasWeatherData}"
                                    AutomationId="WeatherDetailsButton"
                                    SemanticProperties.Description="Afficher les dÃ©tails mÃ©tÃ©o"
                                    SemanticProperties.Hint="Appuyez pour voir les dÃ©tails mÃ©tÃ©o complets" />
                        </Grid>

                        <!-- Loading indicator -->
                        <StackLayout Orientation="Horizontal" 
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding IsLoadingWeather}"
                                   Spacing="10">
                            <ActivityIndicator IsRunning="{Binding IsLoadingWeather}"
                                             Color="{StaticResource Primary}"
                                             WidthRequest="20"
                                             HeightRequest="20" />
                            <Label Text="Chargement des donnÃ©es mÃ©tÃ©o..."
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondary}"
                                   VerticalOptions="Center" />
                        </StackLayout>

                        <!-- Weather content -->
                        <StackLayout IsVisible="{Binding IsLoadingWeather, Converter={StaticResource InvertBoolConverter}}">
                            
                            <!-- Current weather summary -->
                            <Grid ColumnDefinitions="Auto,*,120" ColumnSpacing="15" Margin="0,5">
                                <Label Grid.Column="0"
                                       Text="{Binding CurrentWeather.IconCode, Converter={StaticResource WeatherIconConverter}, FallbackValue='â“'}"
                                       FontSize="48"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       AutomationId="WeatherIcon"
                                       SemanticProperties.Description="IcÃ´ne mÃ©tÃ©o actuelle" />
                                
                                <StackLayout Grid.Column="1" VerticalOptions="Center">
                                    <Label Text="{Binding CurrentWeather.Temperature, StringFormat='{0:F1}Â°C'}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Primary}" />
                                    <Label Text="{Binding CurrentWeather.Description}"
                                           FontSize="14"
                                           TextColor="{StaticResource TextSecondary}" />
                                </StackLayout>
                                
                                <StackLayout Grid.Column="2" VerticalOptions="Center" HorizontalOptions="End" Spacing="4">
                                    <Label Text="{Binding CurrentWeather.WindSpeed, StringFormat='ðŸ’¨ {0:F0} km/h'}"
                                           FontSize="14"
                                           TextColor="{StaticResource TextSecondary}"
                                           HorizontalOptions="End"
                                           AutomationId="WindSpeedLabel"
                                           SemanticProperties.Description="Vitesse du vent" />
                                    <Label Text="{Binding CurrentWeather.Humidity, StringFormat='ðŸ’§ {0}%'}"
                                           FontSize="14"
                                           TextColor="{StaticResource TextSecondary}"
                                           HorizontalOptions="End"
                                           AutomationId="HumidityLabel"
                                           SemanticProperties.Description="Taux d'humiditÃ©" />
                                </StackLayout>
                            </Grid>

                            <!-- Diving conditions -->
                            <Frame Padding="10" 
                                   Margin="0,10,0,0"
                                   BackgroundColor="{Binding DivingConditions.SafetyScore, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='#E8F5E8|#FFF3E0'}"
                                   BorderColor="{Binding DivingConditions.SafetyScore, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='#4CAF50|#FFC107'}"
                                   IsVisible="{Binding DivingConditions, Converter={StaticResource IsNotNullConverter}}">
                                <StackLayout Spacing="5">
                                    <Label Text="Conditions de plongÃ©e"
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           TextColor="{StaticResource Primary}" />
                                    
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                        <Label Grid.Column="0"
                                               Text="{Binding DivingConditions.OverallCondition}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center" />
                                        
                                        <Label Grid.Column="1"
                                               Text="{Binding DivingConditions.SafetyScore, StringFormat='âš¡ {0}/100'}"
                                               FontSize="14"
                                               TextColor="{StaticResource TextSecondary}"
                                               VerticalOptions="Center" />
                                    </Grid>
                                    
                                    <Label Text="{Binding DivingConditions.Assessment}"
                                           FontSize="12"
                                           TextColor="{StaticResource TextSecondary}"
                                           IsVisible="{Binding DivingConditions.Assessment, Converter={StaticResource StringNotEmptyConverter}}" />
                                </StackLayout>
                            </Frame>

                            <!-- Last update -->
                            <Label Text="{Binding CurrentWeather.LastUpdated, StringFormat='DerniÃ¨re mise Ã  jour: {0:HH:mm}'}"
                                   FontSize="10"
                                   TextColor="{StaticResource TextSecondary}"
                                   HorizontalOptions="End"
                                   Margin="0,5,0,0" />
                        </StackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Weather error message -->
                <Frame Padding="15" 
                       BackgroundColor="#FFEBEE"
                       BorderColor="#F44336"
                       IsVisible="{Binding ShowWeatherError}">
                    <StackLayout Orientation="Horizontal" Spacing="10">
                        <Label Text="!"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#F44336"
                               BackgroundColor="White"
                               WidthRequest="24"
                               HeightRequest="24"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               VerticalOptions="Center" />
                        <Label Text="{Binding WeatherErrorMessage}"
                               FontSize="14"
                               TextColor="#D32F2F"
                               VerticalOptions="Center"
                               HorizontalOptions="FillAndExpand" />
                        <Button Text="RÃ©essayer"
                                FontSize="12"
                                Padding="8,4"
                                BackgroundColor="Transparent"
                                TextColor="#D32F2F"
                                BorderColor="#D32F2F"
                                BorderWidth="1"
                                Command="{Binding RefreshWeatherCommand}"
                                VerticalOptions="Center" />
                    </StackLayout>
                </Frame>

                <!--  Informations complÃ©mentaires  -->
                <Frame Padding="15" BorderColor="{StaticResource Secondary}">
                    <VerticalStackLayout Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            Text="Informations complÃ©mentaires"
                            TextColor="{StaticResource Primary}" />

                        <Grid
                            ColumnDefinitions="Auto,*"
                            ColumnSpacing="10"
                            RowDefinitions="Auto,Auto,Auto,Auto,Auto"
                            RowSpacing="10">
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="Ã‰quipement requis:" />
                            <Label
                                Grid.Row="0"
                                Grid.Column="1"
                                Text="{Binding Spot.RequiredEquipment}" />

                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="Meilleures conditions:" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="1"
                                Text="{Binding Spot.BestConditions}" />

                            <Label
                                Grid.Row="2"
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="CrÃ©Ã© par:" />
                            <Label
                                Grid.Row="2"
                                Grid.Column="1"
                                Text="{Binding CreatorName}" />

                            <Label
                                Grid.Row="3"
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="AjoutÃ© le:" />
                            <Label
                                Grid.Row="3"
                                Grid.Column="1"
                                Text="{Binding Spot.CreatedAt, StringFormat='{0:dd/MM/yyyy}'}" />

                            <Label
                                Grid.Row="4"
                                Grid.Column="0"
                                FontAttributes="Bold"
                                Text="DerniÃ¨re vÃ©rification:" />
                            <Label
                                Grid.Row="4"
                                Grid.Column="1"
                                Text="{Binding Spot.LastSafetyReview, StringFormat='{0:dd/MM/yyyy}'}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Load more photos button -->
                <Button Text="Charger plus de photos"
                        Command="{Binding LoadMoreMediaCommand}"
                        IsVisible="{Binding HasPhotos}"
                        Style="{StaticResource ButtonOutlinedStyle}"
                        Margin="0,10,0,0"
                        AutomationId="LoadMorePhotosButton"
                        SemanticProperties.Description="Charger plus de photos du spot"
                        SemanticProperties.Hint="Appuyez pour charger des photos supplÃ©mentaires" />

                <!--  Boutons d'action  -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                    <Button
                        Grid.Column="0"
                        Command="{Binding ShareSpotCommand}"
                        Style="{StaticResource ButtonOutlinedStyle}"
                        Text="Partager" />

                    <Button
                        Grid.Column="1"
                        Command="{Binding ReportSpotCommand}"
                        Style="{StaticResource ButtonDangerStyle}"
                        Text="Signaler" />
                </Grid>

            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Loading state -->
        <Grid IsVisible="{Binding IsLoading}"
              BackgroundColor="{StaticResource Background}">
            <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="20">
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   Color="{StaticResource Primary}"
                                   HeightRequest="50"
                                   WidthRequest="50"
                                   AutomationId="SpotDetailsLoadingIndicator" />
                <Label Text="Chargement des dÃ©tails du spot..."
                       HorizontalOptions="Center"
                       FontSize="16"
                       TextColor="{StaticResource TextSecondary}"
                       SemanticProperties.Description="Chargement des informations du spot en cours" />
            </StackLayout>
        </Grid>
        
        <!-- Error state -->
        <Grid IsVisible="{Binding IsError}"
              BackgroundColor="{StaticResource Background}">
            <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="20" Padding="40">
                <Label Text="Error"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Error}"
                       HorizontalOptions="Center"
                       SemanticProperties.Description="Erreur de chargement" />
                <Label Text="{Binding ErrorMessage}"
                       HorizontalOptions="Center"
                       FontSize="16"
                       TextColor="{StaticResource Error}"
                       HorizontalTextAlignment="Center"
                       AutomationId="ErrorMessageLabel"
                       SemanticProperties.Description="Message d'erreur" />
                <Button Text="RÃ©essayer"
                        Command="{Binding RefreshCommand}"
                        Style="{StaticResource ButtonPrimaryStyle}"
                        HorizontalOptions="Center"
                        AutomationId="RetryButton"
                        SemanticProperties.Description="Bouton pour rÃ©essayer le chargement"
                        SemanticProperties.Hint="Appuyez pour recharger les informations du spot" />
            </StackLayout>
        </Grid>
    </Grid>
    
    <!-- Success/Error toast message -->
    <Frame Grid.Row="2"
           Padding="15,10"
           Margin="10,5"
           BackgroundColor="{Binding ToastBackgroundColor}"
           BorderColor="{Binding ToastBorderColor}"
           IsVisible="{Binding ShowToast}"
           AutomationId="ToastMessage">
        <Label Text="{Binding ToastMessage}"
               TextColor="{Binding ToastTextColor}"
               FontSize="14"
               HorizontalOptions="Center"
               SemanticProperties.Description="Message de notification" />
    </Frame>
</Grid>
</ContentPage>