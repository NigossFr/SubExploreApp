<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SubExplore.Views.Profile.UserProfilePage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SubExplore.ViewModels.Profile"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:UserProfileViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">

        <!-- Search and Profile Section -->
        <Frame Grid.Row="0" 
               Padding="15"
               BackgroundColor="{StaticResource Background}"
               BorderColor="Transparent">
            <StackLayout Spacing="15">
            
            <!-- Loading & Error States -->
            <Grid IsVisible="{Binding IsLoading}" Padding="0,40">
                <StackLayout HorizontalOptions="Center" Spacing="16">
                    <ActivityIndicator IsRunning="{Binding IsLoading}"
                                     Color="{StaticResource Primary}"
                                     WidthRequest="48" 
                                     HeightRequest="48" />
                    <Label Text="Chargement de votre profil..."
                           FontSize="16"
                           TextColor="{StaticResource Gray600}"
                           HorizontalTextAlignment="Center"
                           LineHeight="1.4" />
                </StackLayout>
            </Grid>

            <!-- Error State with Action -->
            <Frame IsVisible="{Binding IsError}" 
                   BackgroundColor="{StaticResource Danger}" 
                   CornerRadius="12" 
                   Padding="16" 
                   HasShadow="False">
                <StackLayout Spacing="12">
                    <Label Text="⚠️ Erreur de chargement"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalTextAlignment="Center"
                           LineHeight="1.3" />
                    <Label Text="{Binding ErrorMessage}"
                           FontSize="15"
                           TextColor="White"
                           HorizontalTextAlignment="Center"
                           LineBreakMode="WordWrap"
                           LineHeight="1.5" />
                    <Button Text="Réessayer"
                            Command="{Binding RefreshCommand}"
                            BackgroundColor="White"
                            TextColor="{StaticResource Danger}"
                            CornerRadius="8"
                            Padding="16,8"
                            HorizontalOptions="Center" />
                </StackLayout>
            </Frame>

                <!-- Profile Content -->
                <StackLayout IsVisible="{Binding IsLoading, Converter={StaticResource InvertBoolConverter}}" Spacing="16">
                
                <!-- Profile Header -->
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" Margin="0,0,0,8">
                    
                    <!-- Avatar -->
                    <Frame Grid.Column="0"
                           BackgroundColor="White"
                           CornerRadius="35"
                           Padding="2"
                           WidthRequest="70"
                           HeightRequest="70"
                           HasShadow="False">
                        <Image Source="{Binding AvatarUrl}"
                               Aspect="AspectFill"
                               WidthRequest="66"
                               HeightRequest="66">
                            <Image.Clip>
                                <EllipseGeometry Center="33,33" RadiusX="33" RadiusY="33" />
                            </Image.Clip>
                            <Image.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ChangeAvatarCommand}" />
                            </Image.GestureRecognizers>
                        </Image>
                    </Frame>
                    
                    <!-- User Info -->
                    <StackLayout Grid.Column="1" VerticalOptions="Center" Spacing="4">
                        <Label Text="{Binding DisplayName}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimary}"
                               LineBreakMode="TailTruncation" />
                        <Label Text="{Binding CurrentUser.Username, StringFormat='@{0}'}"
                               FontSize="14"
                               TextColor="{StaticResource TextSecondary}" />
                        <Label Text="{Binding MemberSince, StringFormat='Membre depuis {0}'}"
                               FontSize="12"
                               TextColor="{StaticResource TextSecondary}" />
                    </StackLayout>
                    
                    <!-- Edit Button -->
                    <Button Grid.Column="2"
                            Text="✏️"
                            FontSize="18"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            WidthRequest="48"
                            HeightRequest="40"
                            CornerRadius="20"
                            Padding="2"
                            Command="{Binding ToggleEditModeCommand}"
                            IsVisible="{Binding IsEditMode, Converter={StaticResource InvertBoolConverter}}" />
                </Grid>

                <!-- Statistics Cards -->
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10" IsVisible="{Binding HasStats}">
                    
                    <!-- Total Spots -->
                    <Frame Grid.Column="0"
                           Padding="10"
                           BackgroundColor="{StaticResource Primary}"
                           CornerRadius="8"
                           HasShadow="False">
                        <StackLayout HorizontalOptions="Center" Spacing="2">
                            <Label Text="{Binding UserStats.TotalSpots}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                            <Label Text="Spots"
                                   FontSize="10"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ViewStatsCommand}" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    
                    <!-- Validated Spots -->
                    <Frame Grid.Column="1"
                           Padding="10"
                           BackgroundColor="{StaticResource Success}"
                           CornerRadius="8"
                           HasShadow="False">
                        <StackLayout HorizontalOptions="Center" Spacing="2">
                            <Label Text="{Binding UserStats.ValidatedSpots}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                            <Label Text="Validés"
                                   FontSize="10"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                        </StackLayout>
                    </Frame>
                    
                    <!-- Contribution Score -->
                    <Frame Grid.Column="2"
                           Padding="10"
                           BackgroundColor="{StaticResource Warning}"
                           CornerRadius="8"
                           HasShadow="False">
                        <StackLayout HorizontalOptions="Center" Spacing="2">
                            <Label Text="{Binding UserStats.ContributionScore}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                            <Label Text="Points"
                                   FontSize="10"
                                   TextColor="White"
                                   HorizontalOptions="Center" />
                        </StackLayout>
                    </Frame>
                </Grid>
                </StackLayout>
            </StackLayout>
        </Frame>

        <!-- Content Area -->
        <ScrollView Grid.Row="1">
            <StackLayout Spacing="16" Padding="16">

                <!-- Edit Mode Form -->
                <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource Gray800}}" 
                       BorderColor="{AppThemeBinding Light={StaticResource BorderColor}, Dark={StaticResource Gray700}}"
                       CornerRadius="12" 
                       IsVisible="{Binding IsEditMode}" 
                       Padding="16" 
                       HasShadow="False">
                    <StackLayout Spacing="16">
                        <Label Text="Modifier le profil" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="{StaticResource TextPrimary}" />

                        <!-- Validation Message -->
                        <Label Text="{Binding ValidationMessage}"
                               TextColor="Red"
                               FontSize="14"
                               IsVisible="{Binding ValidationMessage, Converter={toolkit:IsStringNotNullOrEmptyConverter}}" />

                        <!-- First Name -->
                        <StackLayout>
                            <Label Text="Prénom" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Entry Text="{Binding FirstName}" 
                                   BackgroundColor="White" 
                                   IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </StackLayout>

                        <!-- Last Name -->
                        <StackLayout>
                            <Label Text="Nom de famille" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Entry Text="{Binding LastName}" 
                                   BackgroundColor="White" 
                                   IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </StackLayout>

                        <!-- Username -->
                        <StackLayout>
                            <Label Text="Nom d'utilisateur" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Entry Text="{Binding Username}" 
                                   BackgroundColor="White" 
                                   IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </StackLayout>

                        <!-- Email -->
                        <StackLayout>
                            <Label Text="Email" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Entry Text="{Binding Email}" 
                                   Keyboard="Email" 
                                   BackgroundColor="White" 
                                   IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </StackLayout>

                        <!-- Expertise Level -->
                        <StackLayout>
                            <Label Text="Niveau d'expertise" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Picker ItemsSource="{Binding ExpertiseLevel}" 
                                    SelectedItem="{Binding ExpertiseLevel}" 
                                    BackgroundColor="White"
                                    IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </StackLayout>

                        <!-- Buttons -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Button Grid.Column="0"
                                    Text="Annuler" 
                                    Command="{Binding ToggleEditModeCommand}"
                                    BackgroundColor="{StaticResource Surface}"
                                    TextColor="{StaticResource TextPrimary}"
                                    BorderColor="{StaticResource BorderColor}"
                                    BorderWidth="1"
                                    CornerRadius="8"
                                    HeightRequest="44"
                                    IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                            
                            <Button Grid.Column="1"
                                    Text="Enregistrer" 
                                    Command="{Binding SaveProfileCommand}"
                                    BackgroundColor="{StaticResource Primary}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HeightRequest="44"
                                    IsEnabled="{Binding IsUpdating, Converter={StaticResource InvertBoolConverter}}" />
                        </Grid>

                        <!-- Updating Indicator -->
                        <ActivityIndicator IsVisible="{Binding IsUpdating}" 
                                         IsRunning="{Binding IsUpdating}"
                                         Color="{StaticResource Primary}"
                                         HorizontalOptions="Center" />
                    </StackLayout>
                </Frame>

                <!-- Certifications Section -->
                <Frame BackgroundColor="{StaticResource Primary}" 
                       CornerRadius="12" 
                       IsVisible="{Binding HasCertifications}" 
                       Padding="16" 
                       HasShadow="False"
                       Margin="0,0,0,5">
                    <StackLayout Spacing="10">
                        <Label Text="Certifications"
                               FontSize="15"
                               FontAttributes="Bold"
                               TextColor="White" />
                        
                        <CollectionView ItemsSource="{Binding CertificationsList}"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:CertificationItem">
                                    <Grid ColumnDefinitions="Auto,*,Auto" 
                                          Padding="6,3"
                                          ColumnSpacing="8">
                                        <Frame Grid.Column="0"
                                               BackgroundColor="{StaticResource Warning}"
                                               CornerRadius="6"
                                               Padding="4"
                                               WidthRequest="16"
                                               HeightRequest="16"
                                               HasShadow="False"
                                               VerticalOptions="Center" />
                                        <StackLayout Grid.Column="1" Spacing="1">
                                            <Label Text="{Binding Type}"
                                                   FontSize="13"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding Level}"
                                                   FontSize="11"
                                                   TextColor="White"
                                                   LineBreakMode="TailTruncation" />
                                        </StackLayout>
                                        <Label Grid.Column="2"
                                               Text="{Binding Date, StringFormat='{0:MMM yyyy}'}"
                                               FontSize="10"
                                               TextColor="White"
                                               VerticalOptions="Center" />
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Frame>

                <!-- Account Information Section -->
                <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource Gray800}}" 
                       BorderColor="{AppThemeBinding Light={StaticResource BorderColor}, Dark={StaticResource Gray700}}"
                       CornerRadius="12" 
                       Padding="16" 
                       HasShadow="False"
                       IsVisible="{Binding IsEditMode, Converter={StaticResource InvertBoolConverter}}">
                    <StackLayout Spacing="12">
                        <Label Text="Informations du compte"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimary}" />
                        
                        <!-- Email Display -->
                        <StackLayout Spacing="4">
                            <Label Text="Adresse email"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                            <Label Text="{Binding CurrentUser.Email}"
                                   FontSize="14"
                                   TextColor="{StaticResource TextPrimary}" />
                        </StackLayout>
                        
                        <!-- Action Buttons -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Button Grid.Column="0"
                                    Text="Changer mot de passe"
                                    Command="{Binding ChangePasswordCommand}"
                                    BackgroundColor="{StaticResource Secondary}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HeightRequest="44"
                                    FontSize="12" />
                            
                            <Button Grid.Column="1"
                                    Text="Voir statistiques"
                                    Command="{Binding ViewStatsCommand}"
                                    BackgroundColor="{StaticResource Primary}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HeightRequest="44"
                                    FontSize="12"
                                    IsVisible="{Binding HasStats}" />
                        </Grid>
                    </StackLayout>
                </Frame>

                <!-- Appearance Preferences Section -->
                <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" 
                       CornerRadius="12" 
                       Padding="16" 
                       HasShadow="False"
                       Margin="0,4,0,8" 
                       IsVisible="{Binding IsEditMode, Converter={StaticResource InvertBoolConverter}}">
                    <StackLayout Spacing="18">
                        <!-- Section Header -->
                        <Label Text="Préférences d'apparence"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="White" />

                        <!-- Theme Selection -->
                        <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                               CornerRadius="8"
                               HasShadow="False"
                               Padding="12">
                            <StackLayout Spacing="8">
                                <Label Text="Thème"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                <Frame BackgroundColor="White"
                                       CornerRadius="8"
                                       HasShadow="False"
                                       Padding="0">
                                    <Picker ItemsSource="{Binding ThemeOptionsDisplay}" 
                                            SelectedIndex="{Binding SelectedThemeIndex}" 
                                            BackgroundColor="Transparent"
                                            FontSize="14"
                                            Margin="12,8"
                                            AutomationId="ThemePicker"
                                            SemanticProperties.Description="Sélectionner le thème d'affichage"
                                            SemanticProperties.Hint="Appuyez pour choisir entre thème clair, sombre ou automatique" />
                                </Frame>
                            </StackLayout>
                        </Frame>

                        <!-- Language Selection -->
                        <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                               CornerRadius="8"
                               HasShadow="False"
                               Padding="12">
                            <StackLayout Spacing="8">
                                <Label Text="Langue"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                <Frame BackgroundColor="White"
                                       CornerRadius="8"
                                       HasShadow="False"
                                       Padding="0">
                                    <Picker ItemsSource="{Binding LanguageOptionsDisplay}" 
                                            SelectedIndex="{Binding SelectedLanguageIndex}" 
                                            BackgroundColor="Transparent"
                                            FontSize="14"
                                            Margin="12,8"
                                            AutomationId="LanguagePicker"
                                            SemanticProperties.Description="Sélectionner la langue de l'interface"
                                            SemanticProperties.Hint="Appuyez pour choisir votre langue préférée" />
                                </Frame>
                            </StackLayout>
                        </Frame>

                        <!-- Display Name Selection -->
                        <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                               CornerRadius="8"
                               HasShadow="False"
                               Padding="12">
                            <StackLayout Spacing="8">
                                <Label Text="Affichage du nom"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                <Frame BackgroundColor="White"
                                       CornerRadius="8"
                                       HasShadow="False"
                                       Padding="0">
                                    <Picker ItemsSource="{Binding DisplayNameOptionsDisplay}" 
                                            SelectedIndex="{Binding SelectedDisplayNameIndex}" 
                                            BackgroundColor="Transparent"
                                            FontSize="14"
                                            Margin="12,8"
                                            AutomationId="DisplayNamePicker"
                                            SemanticProperties.Description="Choisir comment afficher votre nom"
                                            SemanticProperties.Hint="Appuyez pour sélectionner le format d'affichage de votre nom" />
                                </Frame>
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                </Frame>

                <!-- Notification Preferences Section -->
                <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" 
                       CornerRadius="12" 
                       Padding="16" 
                       HasShadow="False"
                       Margin="0,4,0,8" 
                       IsVisible="{Binding IsEditMode, Converter={StaticResource InvertBoolConverter}}">
                    <StackLayout Spacing="18">
                        <!-- Section Header -->
                        <Label Text="Notifications"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="White" />

                        <!-- Enhanced Notification Settings -->
                        <StackLayout Spacing="12">
                            <!-- Push Notifications -->
                            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   Padding="12">
                                <StackLayout Orientation="Horizontal" Spacing="12">
                                    <StackLayout HorizontalOptions="StartAndExpand" VerticalOptions="Center">
                                        <Label Text="Notifications push"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="Recevez des alertes sur votre appareil"
                                               FontSize="12"
                                               TextColor="White" />
                                    </StackLayout>
                                    <Switch IsToggled="{Binding PushNotifications}" 
                                            OnColor="#FFD700"
                                            ThumbColor="White"
                                            VerticalOptions="Center"
                                            BackgroundColor="Transparent"
                                            AutomationId="PushNotificationsSwitch"
                                            SemanticProperties.Description="Activer ou désactiver les notifications push"
                                            SemanticProperties.Hint="Basculez pour modifier ce paramètre" />
                                </StackLayout>
                            </Frame>

                            <!-- Email Notifications -->
                            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   Padding="12">
                                <StackLayout Orientation="Horizontal" Spacing="12">
                                    <StackLayout HorizontalOptions="StartAndExpand" VerticalOptions="Center">
                                        <Label Text="Notifications par email"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="Recevez des résumés par email"
                                               FontSize="12"
                                               TextColor="White" />
                                    </StackLayout>
                                    <Switch IsToggled="{Binding EmailNotifications}" 
                                            OnColor="#FFD700"
                                            ThumbColor="White"
                                            VerticalOptions="Center"
                                            BackgroundColor="Transparent"
                                            AutomationId="EmailNotificationsSwitch"
                                            SemanticProperties.Description="Activer ou désactiver les notifications par email"
                                            SemanticProperties.Hint="Basculez pour modifier ce paramètre" />
                                </StackLayout>
                            </Frame>

                            <!-- Nearby Spots -->
                            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   Padding="12">
                                <StackLayout Orientation="Horizontal" Spacing="12">
                                    <StackLayout HorizontalOptions="StartAndExpand" VerticalOptions="Center">
                                        <Label Text="Nouveaux spots à proximité"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="Découvrez les spots près de vous"
                                               FontSize="12"
                                               TextColor="White" />
                                    </StackLayout>
                                    <Switch IsToggled="{Binding SpotsNearby}" 
                                            OnColor="#FFD700"
                                            ThumbColor="White"
                                            VerticalOptions="Center"
                                            BackgroundColor="Transparent"
                                            AutomationId="SpotsNearbySwitch"
                                            SemanticProperties.Description="Recevoir des notifications pour les nouveaux spots à proximité"
                                            SemanticProperties.Hint="Basculez pour modifier ce paramètre" />
                                </StackLayout>
                            </Frame>

                            <!-- Community Updates -->
                            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   Padding="12">
                                <StackLayout Orientation="Horizontal" Spacing="12">
                                    <StackLayout HorizontalOptions="StartAndExpand" VerticalOptions="Center">
                                        <Label Text="Actualités de la communauté"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="Restez informé des nouvelles"
                                               FontSize="12"
                                               TextColor="White" />
                                    </StackLayout>
                                    <Switch IsToggled="{Binding CommunityUpdates}" 
                                            OnColor="#FFD700"
                                            ThumbColor="White"
                                            VerticalOptions="Center"
                                            BackgroundColor="Transparent"
                                            AutomationId="CommunityUpdatesSwitch"
                                            SemanticProperties.Description="Recevoir les actualités de la communauté SubExplore"
                                            SemanticProperties.Hint="Basculez pour modifier ce paramètre" />
                                </StackLayout>
                            </Frame>

                            <!-- Safety Alerts -->
                            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource Secondary}}"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   Padding="12">
                                <StackLayout Orientation="Horizontal" Spacing="12">
                                    <StackLayout HorizontalOptions="StartAndExpand" VerticalOptions="Center">
                                        <Label Text="Alertes de sécurité"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="Informations importantes de sécurité"
                                               FontSize="12"
                                               TextColor="White" />
                                    </StackLayout>
                                    <Switch IsToggled="{Binding SafetyAlerts}" 
                                            OnColor="#FFD700"
                                            ThumbColor="White"
                                            VerticalOptions="Center"
                                            BackgroundColor="Transparent"
                                            AutomationId="SafetyAlertsSwitch"
                                            SemanticProperties.Description="Recevoir les alertes de sécurité importantes"
                                            SemanticProperties.Hint="Basculez pour modifier ce paramètre" />
                                </StackLayout>
                            </Frame>
                        </StackLayout>
                    </StackLayout>
                </Frame>

                <!-- Save Preferences Button -->
                <Button Text="Enregistrer les préférences"
                        Command="{Binding SavePreferencesCommand}"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                        TextColor="White"
                        FontSize="16"
                        CornerRadius="8"
                        HeightRequest="48"
                        Margin="0,8,0,16"
                        IsVisible="{Binding IsEditMode, Converter={StaticResource InvertBoolConverter}}" />

            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>